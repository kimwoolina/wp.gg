<form action="{% url 'articles:articles' %}" method="POST" enctype="multipart/form-data">
    {% csrf_token %}
    
    <!-- 1. 유저 검색 기능 -->
    <div>
        <input type="text" id="user-search" placeholder="Search for users by username or riot_username">
        <select id="reviewee" name="reviewee">
            <option value="">--평가 할 사람을 고르세요--</option>
        </select>
    </div>
    
    <!-- 2. 이미지 업로드 및 미리보기 -->
    <label for="img">Image</label>
    <input type="file" name="img" id="img" multiple accept="image/*" onchange="previewImages(event)">
    <div id="image-preview"></div>

    <!-- 3. title & content -->
    <label for="title">Title</label>
    <input type="text" name="title" id="title" required><br>
    
    <label for="content">Content</label>
    <input type="text" name="content" id="content" required><br>

    <!-- 4. 이모티콘 점수 선택 -->
    <label for="article_score">Score</label>
    <div id="emoji-score">
        <label>
            <input type="radio" name="article_score" value="10" required> 😍
        </label>
        <label>
            <input type="radio" name="article_score" value="9" required> 🥰
        </label>
        <label>
            <input type="radio" name="article_score" value="8" required> 😘
        </label>
        <label>
            <input type="radio" name="article_score" value="7" required> 😄
        </label>
        <label>
            <input type="radio" name="article_score" value="6" required> 😙
        </label>
        <label>
            <input type="radio" name="article_score" value="5" required> 🙂
        </label>
        <label>
            <input type="radio" name="article_score" value="4" required> 🥺
        </label>
        <label>
            <input type="radio" name="article_score" value="3" required> 😞
        </label>
        <label>
            <input type="radio" name="article_score" value="2" required> 😣
        </label>
        <label>
            <input type="radio" name="article_score" value="1" required> 😡
        </label>
        <label>
            <input type="radio" name="article_score" value="0" required> 🤮
        </label>
    </div>

    <!-- 5. 평가 항목들 -->
    <label> 평가 항목</label>
    <div>
        <input type="checkbox" id="kindness" value="1" name="evaluation">
        <label for="kindness">Kindness</label>

        <input type="checkbox" id="teamwork" value="1" name="evaluation">
        <label for="teamwork">Teamwork</label>

        <input type="checkbox" id="communication" value="1" name="evaluation">
        <label for="communication">Communication</label>

        <input type="checkbox" id="mental_strength" value="1" name="evaluation">
        <label for="mental_strength">Mental Strength</label>

        <input type="checkbox" id="punctuality" value="1" name="evaluation">
        <label for="punctuality">Punctuality</label>

        <input type="checkbox" id="positivity" value="1" name="evaluation">
        <label for="positivity">Positivity</label>

        <input type="checkbox" id="mvp" value="1" name="evaluation">
        <label for="mvp">MVP</label>

        <input type="checkbox" id="mechanical_skill" value="1" name="evaluation">
        <label for="mechanical_skill">Mechanical Skill</label>

        <input type="checkbox" id="operation" value="1" name="evaluation">
        <label for="operation">Operation</label>

        <input type="checkbox" id="negativity" value="1" name="evaluation">
        <label for="negativity">Negativity</label>

        <input type="checkbox" id="profanity" value="1" name="evaluation">
        <label for="profanity">Profanity</label>

        <input type="checkbox" id="afk" value="1" name="evaluation">
        <label for="afk">AFK</label>

        <input type="checkbox" id="cheating" value="1" name="evaluation">
        <label for="cheating">Cheating</label>

        <input type="checkbox" id="verbal_abuse" value="1" name="evaluation">
        <label for="verbal_abuse">Verbal Abuse</label>
    </div>

    <input type="submit" value="Save" />
</form>

<script>
// 1. 유저 검색 기능
document.getElementById('user-search').addEventListener('input', function (e) {
    const query = e.target.value;
    const revieweeSelect = document.getElementById('reviewee');
    revieweeSelect.innerHTML = '<option value="">--평가 할 사람을 고르세요--</option>';
    
    fetch(`/api/articles/search_user/?q=${query}`)
        .then(response => response.json())
        .then(data => {
            data.users.forEach(user => {
                const option = document.createElement('option');
                option.value = user.id;
                option.textContent = `${user.username} | ${user.riot_username}${user.riot_tag}`;
                revieweeSelect.appendChild(option);
            });
        });
});

// 2. 이미지 미리보기 기능
function previewImages(event) {
    const previewContainer = document.getElementById('image-preview');
    previewContainer.innerHTML = '';
    
    const files = event.target.files;
    Array.from(files).forEach(file => {
        const reader = new FileReader();
        reader.onload = function (e) {
            const imgElement = document.createElement('img');
            imgElement.src = e.target.result;
            imgElement.style.maxWidth = '100px';
            imgElement.style.marginRight = '10px';
            previewContainer.appendChild(imgElement);
        };
        reader.readAsDataURL(file);
    });
}

// 3. 라디오 버튼 선택 해제 기능
function toggleRadio(radio) {
    if (radio.checked) {
        radio.checked = false;
    }
}
</script>
