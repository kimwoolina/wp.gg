{% extends "base.html" %}
{% load static %}
{% block title %}ë§¤ì¹­ ê²°ê³¼{% endblock title %}

{% block css %}
<link rel="stylesheet" href="{% static '/css/user_detail.css' %}">
<style>
.center-container {
    text-align: center; 
}
.profile-image {
    width: 90px; 
    height: 90px; 
    border-radius: 50%; 
}
hr.hr-1 {
    width: 90%;
    background-color: #ffff;
    margin-bottom: 40px;
    border:0; height:1px; background: #bbb;
    {% comment %} border: 0;
    border-top: 2px dotted #8c8c8c; {% endcomment %}
    {% comment %} margin-bottom: 40px;
    border: 0;
    height: 1px;
    background-image: linear-gradient(to right, rgba(0, 0, 0, 0), rgba(0, 0, 0, 0.75), rgba(0, 0, 0, 0)); {% endcomment %}
}
</style>
{% endblock css%}

{% block content %}
    <h2>ë‚˜ì™€ í™˜ìƒê¶í•©ì¸ ìœ ì €&nbspâ¤ï¸</h2>

    <div id="matching-result">
        <!-- ê²°ê³¼ í‘œì‹œí•  ì˜ì—­ -->
    </div>

{% endblock content %}

{% block javascript %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // URLì—ì„œ ê²°ê³¼ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
        const urlParams = new URLSearchParams(window.location.search);
        const result = urlParams.get('result');
        const matchingResult = document.getElementById('matching-result');

        if (result) {
            const users = JSON.parse(result);
            if (users.length > 0) {
                users.forEach(user => {
                    const userElement = document.createElement('div');
                    userElement.classList.add('user-card');

                    // ê°€ìš´ë° ì •ë ¬
                    let resultDiv = '<div class="center-container">';

                    // í”„ë¡œí•„ ì´ë¯¸ì§€ ì¶œë ¥
                    if (user.profile_image) {
                        resultDiv += `<img class="profile-image" src="${user.profile_image}" alt="Profile Picture">`;
                    } else {
                        resultDiv += `<img class="profile-image" src="{% static 'img/default_profile_image.png' %}" alt="Profile Picture">`;
                    }
                    resultDiv += '</div>';

                    // ì ìˆ˜ ì¶œë ¥
                    if (user.score !== undefined) {
                        let score = Number(user.score.toFixed(2));
                        resultDiv += `<div class="site-user-info"><h1>${user.username}</h1> <span class="total-score">ğŸ‘${score}</span></div><br>`;
                    }

                    // ë¼ì´ì—‡ ì •ë³´ ì¶œë ¥
                    if (user.riot_username && user.riot_tag) {
                        resultDiv += `<h2 class="riot_username_tag">${user.riot_username || ''}#${user.riot_tag || ''}</h2>`;
                    } else if (user.riot_username) {
                        resultDiv += `<h2 class="riot_username_tag">${user.riot_username}</h2>`;
}

                    // í‰ê°€ í•­ëª© ì¶œë ¥
                    if (user.evaluations) {
                        resultDiv += `<div id="evaluation-container"></div>`;
                        const evaluationDiv = document.createElement('div');
                        evaluationDiv.classList.add('evaluation-container');

                        const evaluations = user.evaluations;
                        if (evaluations.kindness) evaluationDiv.innerHTML += `<div class="evaluation-item">ğŸ’— ìƒëƒ¥í•¨: ${evaluations.kindness}</div>`;
                        if (evaluations.teamwork) evaluationDiv.innerHTML += `<div class="evaluation-item">ğŸ™Œ íŒ€ì›Œí¬: ${evaluations.teamwork}</div>`;
                        if (evaluations.communication) evaluationDiv.innerHTML += `<div class="evaluation-item">ğŸ¤ ì†Œí†µ: ${evaluations.communication}</div>`;
                        if (evaluations.mental_strength) evaluationDiv.innerHTML += `<div class="evaluation-item">ğŸ˜‡ ë©˜íƒˆ ê´€ë¦¬: ${evaluations.mental_strength}</div>`;
                        if (evaluations.punctuality) evaluationDiv.innerHTML += `<div class="evaluation-item">â± ì‹œê°„ ì•½ì†: ${evaluations.punctuality}</div>`;
                        if (evaluations.positivity) evaluationDiv.innerHTML += `<div class="evaluation-item">ğŸŒˆ ê¸ì •ì : ${evaluations.positivity}</div>`;
                        if (evaluations.mvp) evaluationDiv.innerHTML += `<div class="evaluation-item">ğŸ‘‘ MVP: ${evaluations.mvp}</div>`;
                        if (evaluations.mechanical_skill) evaluationDiv.innerHTML += `<div class="evaluation-item">ğŸ’ª í”¼ì§€ì»¬: ${evaluations.mechanical_skill}</div>`;
                        if (evaluations.operation) evaluationDiv.innerHTML += `<div class="evaluation-item">ğŸ§  ìš´ì˜ ëŠ¥ë ¥: ${evaluations.operation}</div>`;
                        if (evaluations.negativity) evaluationDiv.innerHTML += `<div class="evaluation-item">ğŸ™ ë¶€ì •ì  íƒœë„: ${evaluations.negativity}</div>`;
                        if (evaluations.profanity) evaluationDiv.innerHTML += `<div class="evaluation-item">ğŸ¤¬ ìš•ì„¤: ${evaluations.profanity}</div>`;
                        if (evaluations.afk) evaluationDiv.innerHTML += `<div class="evaluation-item">â“ íƒˆì£¼/ìë¦¬ë¹„ì›€: ${evaluations.afk}</div>`;
                        if (evaluations.cheating) evaluationDiv.innerHTML += `<div class="evaluation-item">ğŸ¥· ë¶€ì •í–‰ìœ„: ${evaluations.cheating}</div>`;
                        if (evaluations.verbal_abuse) evaluationDiv.innerHTML += `<div class="evaluation-item">ğŸ˜¡ ê³µê²©ì ì¸ ì–¸í–‰: ${evaluations.verbal_abuse}</div>`;
                        resultDiv += evaluationDiv.outerHTML;
                    }

                    // Articles ì¶œë ¥
                    if (user.articles && user.articles.length > 0) {
                        resultDiv += `<h2>Articles</h2><div id="articles-container"></div>`;
                        const articlesDiv = document.createElement('div');
                        articlesDiv.classList.add('articles-container');

                        user.articles.forEach(article => {
                            const url = `/article/${encodeURIComponent(article.id)}/`;
                            articlesDiv.innerHTML += `
                                <a href="${url}">
                                    <div class="article">
                                        <div class="title-score">
                                            <h3 class="title">${article.title}</h3>
                                            <span class="article-score">ğŸ‘${article.article_score}</span>
                                        </div>
                                        <div class="created-at">${new Date(article.created_at).toLocaleString()}</div>
                                    </div>
                                </a>
                            `;
                        });
                        resultDiv += articlesDiv.outerHTML;
                    }
                    resultDiv += '<hr class="hr-1">';
                    userElement.innerHTML = resultDiv;
                    matchingResult.appendChild(userElement);
                });
            } else {
                matchingResult.innerHTML = '<p>ë§¤ì¹­ëœ ìœ ì €ê°€ ì—†ìŠµë‹ˆë‹¤.</p>';
            }
        } else {
            matchingResult.innerHTML = '<p>ë§¤ì¹­ ê²°ê³¼ë¥¼ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.</p>';
        }
    });
</script>
{% endblock javascript %}
