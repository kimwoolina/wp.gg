{% extends "base.html" %}
{% load static %}
{% block title %}ìœ ì € ë­í‚¹{% endblock title %}

{% block css %}
<style>
    /* ì „ì²´ ë°°ê²½ìƒ‰ */
    body {
        background-color: #1E1E1E;
        color: #fff;
    }

    /* ìœ ì € ê²€ìƒ‰ ìƒì */
    .user-search-container {
        margin: 30px;
        padding: 4px;
        display: flex;
        gap: 10px;
        max-width: 820px;
        width: 100%;
        margin: 5%;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.2);
        box-sizing: border-box;
        border-radius: 10px;
        overflow-y: auto;
        max-height: 1000px;
        font-family: 'Arial', sans-serif;
        font-size: 16px;
        font-weight: bold;
    }

    .reviewee-select {
        width: 176px;
        padding: 10px;
        border-radius: 13px;
        background-color: #333;
        color: #deddec;
        margin-top: 34px;
        font-size: 14px;
        margin-left: 5px;
        border: transparent;
    }

    /* ì´ëª¨í‹°ì½˜ ì ìˆ˜ ì„ íƒ */
    .emoji-score label {
        font-size: 50px;
        margin-right: 15px;
        cursor: pointer;
        margin-bottom: 30px;
    }

    /* ë¦¬ë·° ë‚´ìš© */
    .content-box {
        width: 91%;
        height: 100px;
        border-radius: 15px;
        background-color: #333;
        color: #dbe1ff;
        border: none;
        padding: 16px;
        font-size: 16px;
        margin-top: 29px;
    }

    /* í‰ê°€ í•­ëª© ìŠ¤íƒ€ì¼ */
    .review-categories {
        display: flex;
        flex-wrap: wrap;
        gap: 11px;
        padding: 20px;
    }

    .review-categories label {
        background-color: #444;
        padding: 10px;
        border-radius: 15px;
        cursor: pointer;
        font-size: 14px;
    }

    .review-categories .badge {
        background-color: #fdfdfd;
        color: #31273d;
        padding: 4px 10px;
        border-radius: 14px;
        border: 2px solid transparent;
        cursor: pointer;
        transition: all 0.3s ease;
        font-size: 18px;
    }

    .review-categories .badge:hover {
        background-color: #f0f0f0;
        border: 3px solid #119c77;
        color: #119c77;
    }

    .review-categories .badge.selected {
        background-color: #6d618b;
        color: #e3d8ff;
        border: 2px solid #119c77;
    }

    /* ì œì¶œ ë²„íŠ¼ */
    .submit-btn {
        margin-top: 40px;
        padding: 8px 17px;
        background-color: #716490;
        color: white;
        border: none;
        border-radius: 10px;
        cursor: pointer;
        font-size: 16px;
    }

    .submit-btn:hover {
        background-color: #8B72B1;
    }

    /* íƒœê·¸ ì»¨í…Œì´ë„ˆ */
    .tag-container {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
        padding: 10px;
        background-color: #1e1e1e;
    }

    .tag-label {
        display: flex;
        align-items: center;
        background-color: white;
        padding: 7px 10px;
        border-radius: 25px;
        border: 2px solid transparent;
        cursor: pointer;
        transition: all 0.3s ease;
        font-size: 18px;
    }

    .tag-label span {
        margin-left: 8px;
        font-weight: bold;
        color: black;
    }

    .tag-label:hover {
        background-color: #f0f0f0;
        border-color: #716490;
    }

    .tag-label input:checked + span {
        background-color: #6f69a5;
        color: white;
        padding: 5px 10px;
        border-radius: 25px;
    }

    /* ë‹ë³´ê¸° ì•„ì´ì½˜ ìŠ¤íƒ€ì¼ */
    .search-btn {
        width: 24px;
        height: 29px;
        cursor: pointer;
        margin-left: 635px;
        margin-top: -70px;
    }

    .search-btn:hover {
        fill: #8B72B1;
    }

    /* ê²€ìƒ‰ ë°” ìŠ¤íƒ€ì¼ */
    .search-bar {
        padding: 16px;
        border-radius: 19px;
        background-color: #464646;
        border: none;
        color: #fff;
        font-size: 16px;
        margin-bottom: 20px;
        width: 57%;
        margin-left: 185px;
    }
    

</style>
{% load static %}
<link rel="stylesheet" href="{% static '/css/rank.css' %}">
{% endblock css %}
{% block content %}

    <h1>ë§¤ë„ˆ ë­í‚¹ ğŸ… </h1>
    <div class="top-container">
        <div class="filter-container">
            <label for="positions">í¬ì§€ì…˜ ì„ íƒ:</label>
            <select id="positions" size="1">
                <option value="">ì „ì²´</option>
                <option value="top">íƒ‘</option>
                <option value="jungle">ì •ê¸€</option>
                <option value="mid">ë¯¸ë“œ</option>
                <option value="adc">ì›ë”œ</option>
                <option value="support">ì„œí¬í„°</option>
            </select>

            <label for="sort_by">ì •ë ¬ ê¸°ì¤€:</label>
            <select id="sort_by">
                <option value="score">ì ìˆ˜</option>
                <option value="kindness">ì¹œì ˆí•¨</option>
                <option value="teamwork">íŒ€ì›Œí¬</option>
                <option value="communication">ì†Œí†µ</option>
                <option value="mental_strength">ì •ì‹ ë ¥</option>
                <option value="punctuality">ì„±ì‹¤í•¨</option>
                <option value="positivity">ê¸ì •ì </option>
                <option value="mvp">MVP</option>
                <option value="mechanical_skill">í”¼ì§€ì»¬</option>
                <option value="operation">ìš´ì˜</option>
            </select>

            <button onclick="applyFilters()">í•„í„° ì ìš©</button>
        </div>
    </div>

    <table id="ranking-table">
        <!-- <thead>
            <tr>
                <th>ìˆœìœ„</th>
                <th>ì‚¬ìš©ì ì´ë¦„</th>
                <th>ë¼ì´ì—‡ ì‚¬ìš©ì ì´ë¦„</th>
                <th>ë¼ì´ì—‡ íƒœê·¸</th>
                <th>ì´ì </th>
                <th>ì¹œì ˆí•¨</th>
                <th>íŒ€ì›Œí¬</th>
                <th>ì†Œí†µ</th>
                <th>ì •ì‹ ë ¥</th>
                <th>ì„±ì‹¤í•¨</th>
                <th>ê¸ì •ì </th>
                <th>MVP</th>
                <th>í”¼ì§€ì»¬</th>
                <th>ìš´ì˜</th>
            </tr>
        </thead> -->
        <tbody>
            <!-- ë°ì´í„°ê°€ ì—¬ê¸°ì— ì¶”ê°€ë©ë‹ˆë‹¤. -->
        </tbody>
    </table>
{% endblock content %}
{% block javascript %}
    <script>
        // ì´ˆê¸° ë°ì´í„° ë¡œë“œ
        function loadInitialData() {
            fetch('/api/profile/rankings/')
                .then(response => {
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    return response.json();
                })
                .then(data => {
                    console.log('Initial data:', data); // API í˜¸ì¶œ ê²°ê³¼ ì¶œë ¥
                    renderTable(data); // ì‚¬ìš©ì ë°°ì—´ì„ ë°”ë¡œ ì „ë‹¬
                })
                .catch(error => console.error('Error loading data:', error));
        }

        // í…Œì´ë¸” ë Œë”ë§ í•¨ìˆ˜
        function renderTable(users) {
            const tableBody = document.querySelector('#ranking-table tbody');
            tableBody.innerHTML = ''; // ê¸°ì¡´ ë‚´ìš© ì´ˆê¸°í™”

            if (!users || users.length === 0) {
                const row = document.createElement('tr');
                row.innerHTML = '<td colspan="18">í•´ë‹¹ ì¡°ê±´ì— ë§ëŠ” ìœ ì € ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤.</td>';
                tableBody.appendChild(row);
                return;
            }

            users.forEach((user, index) => {
                const row = document.createElement('dl');
                let score = Number(user.score.toFixed(2));
                console.log(user.riot_username)
                if (user.riot_username == null){
                    row.innerHTML = `
                    <dt class="user-info">
                        <h2>${index + 1}ìœ„ ${user.username} ${user.riot_username || ''} ${user.riot_tag || ''}</h2> 
                        <span class="user-score">ğŸ‘${score}<span>
                    </dt>
                    <dd>
                    ğŸ’—ìƒëƒ¥í•¨ ${user.evaluations.kindness} 
                    ğŸ™ŒğŸ»íŒ€ì›Œí¬ ${user.evaluations.teamwork} 
                    ğŸ¤ì†Œí†µ ${user.evaluations.communication} 
                    ğŸ˜‡ë©˜íƒˆ ${user.evaluations.mental_strength} 
                    â±ì‹œê°„ì•½ì† ${user.evaluations.punctuality} 
                    ğŸ¥°ê¸ì •ì  ${user.evaluations.positivity} 
                    ğŸ‘‘mvp ${user.evaluations.mvp} 
                    ğŸ’ªí”¼ì§€ì»¬ ${user.evaluations.mechanical_skill} 
                    ğŸ§ ìš´ì˜ëŠ¥ë ¥ ${user.evaluations.operation} 
                    <dd>
                    `;
                }else{
                    row.innerHTML = `
                    <dt class="user-info">
                        <h2>${index + 1}ìœ„ ${user.username} (${user.riot_username} #${user.riot_tag || 'KR1'})</h2> 
                        <span class="user-score">ğŸ‘${score}<span>
                    </dt>
                    <dd>
                    ğŸ’—ìƒëƒ¥í•¨ ${user.evaluations.kindness} 
                    ğŸ™ŒğŸ»íŒ€ì›Œí¬ ${user.evaluations.teamwork} 
                    ğŸ¤ì†Œí†µ ${user.evaluations.communication} 
                    ğŸ˜‡ë©˜íƒˆ ${user.evaluations.mental_strength} 
                    â±ì‹œê°„ì•½ì† ${user.evaluations.punctuality} 
                    ğŸ¥°ê¸ì •ì  ${user.evaluations.positivity} 
                    ğŸ‘‘mvp ${user.evaluations.mvp} 
                    ğŸ’ªí”¼ì§€ì»¬ ${user.evaluations.mechanical_skill} 
                    ğŸ§ ìš´ì˜ëŠ¥ë ¥ ${user.evaluations.operation} 
                    <dd>
                `;
                }
                
                tableBody.appendChild(row);
            });
        }

        function getSelectedValues(selectElement) {
            const selectedOptions = Array.from(selectElement.options)
                .filter(option => option.selected)
                .map(option => option.value);
            return selectedOptions.join(',');
        }

        function applyFilters() {
            const positions = getSelectedValues(document.getElementById('positions'));
            const sortBy = document.getElementById('sort_by').value; // ì„ íƒí•œ ì •ë ¬ ê¸°ì¤€ ê°€ì ¸ì˜¤ê¸°
            console.log(positions)
            let url = '/api/profile/rankings/?';
            if (positions) {
                url += `positions=${positions}`;
            }
            if (sortBy) {
                if(positions){
                    url += `&`;
                }
                url += `sort_by=${sortBy}`;
            }

            fetch(url)
                .then(response => {
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    return response.json();
                })
                .then(data => {
                    console.log('Filtered data:', data); // í•„í„°ë§ëœ ê²°ê³¼ ì¶œë ¥
                    renderTable(data); // ì‚¬ìš©ì ë°°ì—´ì„ ë°”ë¡œ ì „ë‹¬
                })
                .catch(error => console.error('Error applying filters:', error));
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
        window.onload = loadInitialData;
    </script>
{% endblock javascript %}