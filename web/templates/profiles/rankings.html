{% extends "base.html" %}

{% block title %}titleë‚´ìš©{% endblock title %}

{% block css %}
{% load static %}
<link rel="stylesheet" href="{% static '/css/rank.css' %}">
{% endblock css %}
{% block content %}

    <h1>ìœ ì € ë­í‚¹</h1>
    <div class="top-container">
        <div class="filter-container">
            <label for="positions">í¬ì§€ì…˜ ì„ íƒ:</label>
            <select id="positions" multiple>
                <option value="top">íƒ‘</option>
                <option value="jungle">ì •ê¸€</option>
                <option value="mid">ë¯¸ë“œ</option>
                <option value="adc">ì›ë”œ</option>
                <option value="support">ì„œí¬í„°</option>
            </select>

            <label for="sort_by">ì •ë ¬ ê¸°ì¤€:</label>
            <select id="sort_by">
                <option value="score">ì ìˆ˜</option>
                <option value="kindness">ì¹œì ˆí•¨</option>
                <option value="teamwork">íŒ€ì›Œí¬</option>
                <option value="communication">ì†Œí†µ</option>
                <option value="mental_strength">ì •ì‹ ë ¥</option>
                <option value="punctuality">ì„±ì‹¤í•¨</option>
                <option value="positivity">ê¸ì •ì </option>
                <option value="mvp">MVP</option>
                <option value="mechanical_skill">í”¼ì§€ì»¬</option>
                <option value="operation">ìš´ì˜</option>
            </select>

            <button onclick="applyFilters()">í•„í„° ì ìš©</button>
        </div>
    </div>

    <div id="rank-list"> <!-- ë°ì´í„°ê°€ ì—¬ê¸°ì— ì¶”ê°€ë©ë‹ˆë‹¤. --> </div>
    <table id="ranking-table">
        <thead>
            <tr>
                <th>ìˆœìœ„</th>
                <th>ì‚¬ìš©ì ì´ë¦„</th>
                <th>ë¼ì´ì—‡ ì‚¬ìš©ì ì´ë¦„</th>
                <th>ë¼ì´ì—‡ íƒœê·¸</th>
                <th>ì´ì </th>
                <th>ì¹œì ˆí•¨</th>
                <th>íŒ€ì›Œí¬</th>
                <th>ì†Œí†µ</th>
                <th>ì •ì‹ ë ¥</th>
                <th>ì„±ì‹¤í•¨</th>
                <th>ê¸ì •ì </th>
                <th>MVP</th>
                <th>í”¼ì§€ì»¬</th>
                <th>ìš´ì˜</th>
            </tr>
        </thead>
        <tbody>
            <!-- ë°ì´í„°ê°€ ì—¬ê¸°ì— ì¶”ê°€ë©ë‹ˆë‹¤. -->
        </tbody>
    </table>
{% endblock content %}
{% block javascript %}
    <script>
        // ì´ˆê¸° ë°ì´í„° ë¡œë“œ
        function loadInitialData() {
            fetch('/api/profile/rankings/')
                .then(response => {
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    return response.json();
                })
                .then(data => {
                    console.log('Initial data:', data); // API í˜¸ì¶œ ê²°ê³¼ ì¶œë ¥
                    renderTable(data); // ì‚¬ìš©ì ë°°ì—´ì„ ë°”ë¡œ ì „ë‹¬
                })
                .catch(error => console.error('Error loading data:', error));
        }

        // í…Œì´ë¸” ë Œë”ë§ í•¨ìˆ˜
        function renderTable(users) {
            const tableBody = document.querySelector('#ranking-table tbody');
            tableBody.innerHTML = ''; // ê¸°ì¡´ ë‚´ìš© ì´ˆê¸°í™”

            if (!users || users.length === 0) {
                const row = document.createElement('tr');
                row.innerHTML = '<td colspan="18">í•´ë‹¹ ì¡°ê±´ì— ë§ëŠ” ìœ ì € ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤.</td>';
                tableBody.appendChild(row);
                return;
            }

            users.forEach((user, index) => {
                const row = document.createElement('dl');
                row.innerHTML = `
                    <dt>
                        ${index + 1}ìœ„ ${user.username} ${user.riot_username || 'N/A'} ${user.riot_tag || 'N/A'} 
                        <span id="user-score">${user.score}<span>
                    </dt>
                    <dd>
                    ğŸ’—ìƒëƒ¥í•¨ ${user.evaluations.kindness} 
                    ğŸ™ŒğŸ»íŒ€ì›Œí¬ ${user.evaluations.teamwork} 
                    ğŸ¤ì†Œí†µ ${user.evaluations.communication} 
                    ğŸ˜‡ë©˜íƒˆ ${user.evaluations.mental_strength} 
                    â±ì‹œê°„ì•½ì† ${user.evaluations.punctuality} 
                    ğŸ¥°ê¸ì •ì  ${user.evaluations.positivity} 
                    ğŸ‘‘mvp ${user.evaluations.mvp} 
                    ğŸ’ªí”¼ì§€ì»¬ ${user.evaluations.mechanical_skill} 
                    ğŸ§ ìš´ì˜ëŠ¥ë ¥ ${user.evaluations.operation} 
                    <dd>
                `;
                tableBody.appendChild(row);
            });
        }

        function getSelectedValues(selectElement) {
            const selectedOptions = Array.from(selectElement.options)
                .filter(option => option.selected)
                .map(option => option.value);
            return selectedOptions.join(',');
        }

        function applyFilters() {
            const positions = getSelectedValues(document.getElementById('positions'));
            const sortBy = document.getElementById('sort_by').value; // ì„ íƒí•œ ì •ë ¬ ê¸°ì¤€ ê°€ì ¸ì˜¤ê¸°

            let url = '/api/profile/rankings/?';
            if (positions) {
                url += `positions=${positions}&`;
            }
            if (sortBy) {
                url += `sort_by=${sortBy}`;
            }

            fetch(url)
                .then(response => {
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    return response.json();
                })
                .then(data => {
                    console.log('Filtered data:', data); // í•„í„°ë§ëœ ê²°ê³¼ ì¶œë ¥
                    renderTable(data); // ì‚¬ìš©ì ë°°ì—´ì„ ë°”ë¡œ ì „ë‹¬
                })
                .catch(error => console.error('Error applying filters:', error));
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
        window.onload = loadInitialData;
    </script>
{% endblock javascript %}